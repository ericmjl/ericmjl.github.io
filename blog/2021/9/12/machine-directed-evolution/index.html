<!doctype html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <style media="screen">
        body {
            padding-top: 70px;
            padding-bottom: 70px;
        }

        /* Dark mode styles */
        body.dark-mode {
            background-color: #1a1a1a;
            color: #ffffff;
        }

        body.dark-mode .terminal {
            background-color: #1a1a1a;
            color: #ffffff;
        }

        body.dark-mode a {
            color: #66b3ff;
        }

        body.dark-mode .terminal-menu {
            background-color: #1a1a1a;
        }

        body.dark-mode .terminal-menu li a {
            color: #ffffff;
        }

        body.dark-mode .terminal-menu li a:hover {
            background-color: #333333;
        }

        /* Theme toggle button styles */
        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            background-color: #f0f0f0;
            border: 1px solid #ccc;
        }

        body.dark-mode .theme-toggle {
            background-color: #333;
            color: #fff;
            border-color: #666;
        }

        .container {
            position: relative;
        }
    </style>
    
<!-- Syntax Highlighter. Use pygments. -->
<link rel="stylesheet" href="../../../../../static/pygments.css">


    

<meta property="og:title" content="Machine-Directed Evolution">
<meta property='og:url' content='http://ericmjl.github.io/blog//blog/machine-directed-evolution' />



    <!-- Google Analytics 4 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-51WHZQ1VQ8"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-51WHZQ1VQ8');
    </script>

    <!-- PostHog Analytics -->
    <script>
        !function(t,e){var o,n,p,r;e.__SV||(window.posthog && window.posthog.__loaded)||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.crossOrigin="anonymous",p.async=!0,p.src=s.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="init Xr es pi Zr rs Kr Qr capture Ni calculateEventProperties os register register_once register_for_session unregister unregister_for_session ds getFeatureFlag getFeatureFlagPayload isFeatureEnabled reloadFeatureFlags updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures on onFeatureFlags onSurveysLoaded onSessionId getSurveys getActiveMatchingSurveys renderSurvey displaySurvey cancelPendingSurvey canRenderSurvey canRenderSurveyAsync identify setPersonProperties group resetGroups setPersonPropertiesForFlags resetPersonPropertiesForFlags setGroupPropertiesForFlags resetGroupPropertiesForFlags reset get_distinct_id getGroups get_session_id get_session_replay_url alias set_config startSessionRecording stopSessionRecording sessionRecordingStarted captureException startExceptionAutocapture stopExceptionAutocapture loadToolbar get_property getSessionProperty us ns createPersonProfile hs Vr vs opt_in_capturing opt_out_capturing has_opted_in_capturing has_opted_out_capturing get_explicit_consent_status is_capturing clear_opt_in_out_capturing ss debug O ls getPageViewId captureTraceFeedback captureTraceMetric qr".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
        posthog.init('phc_907JjTIpyrrIxT5wKiahneMoCl6rMc2XNfaYXrGZ3Fe', {
            api_host: 'https://us.i.posthog.com',
            defaults: '2025-11-30',
            person_profiles: 'identified_only',
        })
    </script>

    <link rel="stylesheet" href="https://unpkg.com/terminal.css@0.7.2/dist/terminal.min.css" />
    <link rel="stylesheet" href="/static/css/custom.css" />
    <!-- Mathjax -->
    <!-- <script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML">
        </script>

    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
    </script> -->

    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
        </script>

    <!-- Mermaid.js -->
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({
            startOnLoad: true,
            theme: 'neutral',
            securityLevel: 'loose'
        });
    </script>
    <style>
        .mermaid {
            background-color: white;
            padding: 1em;
            margin: 1em 0;
            border-radius: 4px;
        }
    </style>

</head>

<title>Machine-Directed Evolution - Eric J. Ma's Personal Site</title>

<body>
    <div class="container">
        <button class="theme-toggle" onclick="toggleTheme()">ðŸŒ™</button>
        <h1 class="logo">
            <a href="/">
                Eric J Ma's Website
            </a>
        </h1>
        <!-- Top Navigation (local links) -->

        <div class="terminal-nav">
            <nav class="terminal-menu" id="local-links">
                <ul>
                    
                    <li class="menu-item">
                        <!-- Set blinking cursor correctly on navigation -->
                        
                        
                        
                        
                        
                        <a href="/" rel="">Home</a>
                        
                    </li>
                    
                    <li class="menu-item">
                        <!-- Set blinking cursor correctly on navigation -->
                        
                        
                        
                        
                        
                        <a class="terminal-prompt" href="/blog" rel="">Blog</a>
                        
                    </li>
                    
                    <li class="menu-item">
                        <!-- Set blinking cursor correctly on navigation -->
                        
                        
                        
                        
                        
                        <a href="/books" rel="">Books</a>
                        
                    </li>
                    
                    <li class="menu-item">
                        <!-- Set blinking cursor correctly on navigation -->
                        
                        
                        
                        
                        
                        <a href="/open-source" rel="">Open Source</a>
                        
                    </li>
                    
                    <li class="menu-item">
                        <!-- Set blinking cursor correctly on navigation -->
                        
                        
                        
                        
                        
                        <a href="/projects" rel="">Projects</a>
                        
                    </li>
                    
                    <li class="menu-item">
                        <!-- Set blinking cursor correctly on navigation -->
                        
                        
                        
                        
                        
                        <a href="/talks" rel="">Talks</a>
                        
                    </li>
                    
                    <li class="menu-item">
                        <!-- Set blinking cursor correctly on navigation -->
                        
                        
                        
                        
                        
                        <a href="/teaching" rel="">Teaching</a>
                        
                    </li>
                    
                    <li class="menu-item">
                        <!-- Set blinking cursor correctly on navigation -->
                        
                        
                        
                        
                        
                        <a href="/user-manual" rel="">User Manual</a>
                        
                    </li>
                    
                    <li class="menu-item">
                        <!-- Set blinking cursor correctly on navigation -->
                        
                        
                        
                        
                        
                        <a href="/bio" rel="">Bio</a>
                        
                    </li>
                    
                    <li class="menu-item">
                        <a href="#" id="search-button" title="Search (Ctrl+K)">Search</a>
                    </li>
                </ul>
            </nav>
        </div>

        <!-- Body -->
        <div id="body">
            


<div class="terminal-card">
  <header id="post_title" name="post_title">
<!-- Set title style -->
<span name="title" id="title">Machine-Directed Evolution</span>
</header>
  <div class="card-body">
    
<!-- Append author -->
<small>
  <p>
    written by
    
    <a class="author" href="https://twitter.com/ericmjl">Eric J. Ma</a>
    
    on
    <span id="pub_date" name="pub_date">2021-09-12</span>

    
    | tags:
    <!-- Append tags after author -->
    <span class="boxed" id="tags" name="tags">
      <a class="tags" href="../../../../tag/science/">
        science
      </a>
    </span>
    <span class="boxed" id="tags" name="tags">
      <a class="tags" href="../../../../tag/paper/">
        paper
      </a>
    </span>
    <span class="boxed" id="tags" name="tags">
      <a class="tags" href="../../../../tag/catalysis/">
        catalysis
      </a>
    </span>
    <span class="boxed" id="tags" name="tags">
      <a class="tags" href="../../../../tag/enzyme engineering/">
        enzyme engineering
      </a>
    </span>
    <span class="boxed" id="tags" name="tags">
      <a class="tags" href="../../../../tag/machine learning/">
        machine learning
      </a>
    </span>
    <span class="boxed" id="tags" name="tags">
      <a class="tags" href="../../../../tag/data science/">
        data science
      </a>
    </span>
    
  </p>
  
</small>

    <hr>

    

    <!-- NOTE: I am keeping this here just for preview purposes.
     We must rely on the webp logo for the blog post.
     Pre-commit hooks will ensure that the png logo is converted to webp.-->
    

    
    <div class="blog-summary">
      <i><p>This is a blog post I've been wanting to put out for a while.
It's about <a href="https://pubs.acs.org/doi/10.1021/acscatal.1c02786">a really cool paper</a> that I had the privilege of working on
with colleagues at the Novartis Institutes for BioMedical Research (NIBR).
If you have institutional access, you can read the paper <a href="https://pubs.acs.org/doi/10.1021/acscatal.1c02786">online</a>.
Here is my layman's summary of the paper.</p>
</i>
    </div>
    

    <span id="post_body" name="post_body">
      <h2 id="the-backdrop">The backdrop</h2><p>In 2019, while I was still at the Novartis Institutes for BioMedical Research (NIBR),
I joined an internal startup team doing enzyme evolution in NIBR's chemistry department.
This project was part of an internal innovation program, Genesis Labs,
where teams are given the space and time to pursue a project idea.
Our team wanted to compare and contrast how traditional directed evolution
fared against machine learning-powered directed evolution
(which we call machine-directed evolution in the paper).</p>
<h2 id="the-scientific-story">The scientific story</h2><p>Our enzyme of choice is IRED,
which is an industrially relevant enzyme for chemistry applications.
We had a choice of IREDs that catalyzed our desired reactions,
some of which were good already and others that were somewhat middling and not ideal.
Our goal wasn't <em>solely</em> to get a good IRED, however.
We <em>also</em> wanted to compare machine-directed evolution
against traditional directed evolution techniques.
Therefore, we picked the "kinda middling" IRED-88 enzyme as our starter enzyme.
That way, we could explore how quickly machine-directed evolution
could help us climb the dynamic range of enzyme goodness
vs. traditional directed evolution.</p>
<p>But what do we <em>exactly</em> mean by enzyme <em>goodness</em>?
We meant to measure enzyme goodness on two axes:
(1) substrate conversion into product and
(2) chiral selectivity.
Conversion measures how much substrate gets converted into the desired product;
for us, higher conversion is better.
Chiral selectivity, if you remember organic chemistry from 2nd-year science curricula,
is all about getting the correct <em>chiral form</em> of the molecule;
chirality results from having a tetrahedral geometry around carbon atoms.
If you're curious to learn more,
<a href="https://en.wikipedia.org/wiki/Asymmetric_carbon">Wikipedia has a great article on this</a>.
When the enzyme catalyzes our reaction,
we get a mixture of R- and S-chiral molecules;
we were interested in maximizing the yield of R-chiral product
while minimizing the production of S-chiral product.</p>
<h3 id="deep-mutational-scan">Deep mutational scan</h3><p>To start, we generated a deep mutational scan (DMS) dataset.
DMS requires the generation of a site-saturation mutagenesis library,
where we generate all possible single-mutant variants of wild-type IRED-88.
Doing so gave us a great starter dataset for machine learning purposes
by covering a large proportion of single-mutant sequence space.
Out of the roughly 6000+ mutants that we could have possibly generated,
we cloned about 81% of them successfully.
Then, we measured their activity;
we also measured their chiral selectivity for a subset of them.
In the subsequent paragraphs, I won't talk much about chiral selectivity.
Still, you know that we always measured selectivity
for a subset of highest activity mutants --
a subset, because chirality is harder to measure at scale.</p>
<p><img src="dms.webp" alt=""></p>
<p><em>Fig. 2(a) from our paper, deep mutational scan measurements.
X-axis: position on linear amino acid sequence of IRED-88.
Y-axis: amino acid substitution.
Heatmap shows activity measurements for ~81%
of all 6000+ possible single point mutations.</em></p>
<p><img src="activity-dist.webp" alt=""></p>
<p><em>Fig. 2(b) from our paper, activity distributions.
X-axis: Bayesian estimated activity of IRED-88 mutants.
Y-axis, top panels: Activity cumulative distribution of our mutants.
Y-axis, bottom panels: Enantioselectivity of our mutants.</em></p>
<p>Even without machine learning, that DMS dataset was highly informative!
We happened to have a crystal structure of IRED-88 on hand.
When we mapped what positions in the linear sequence
were present in the crystal structure,
we noticed that part of the N- and C-termini
(head and tail of the sequence, respectively) were actually not present --
they probably were too floppy to be included as part of the solved structure.
Yet, because we had measurements from the N- and C-termini mutants of IRED,
we found that mutations in the C-termini were beneficial for enzyme activity.
I think this means that a DMS dataset can help uncover potentially good mutants
that we would never have guessed to take a look at,
simply because they were missing in a crystal structure of the same protein.</p>
<h3 id="traditional-directed-evolution">Traditional directed evolution</h3><p>At the same time, we did three rounds of traditional directed evolution.
These are EPPCR1-3 in Fig. 2(b) shown above.
One round was based directly on the wild-type,
generating roughly 4000+ mutants
(with replicates, so go ahead and imagine how many colonies we had to pick).
Out of those enzymes, the winner turned out to be an okay-ish enzyme.
However, in the interest of obtaining a good enzyme,
we decided to take a winner from the deep mutational scan
as our basis for a 2nd round and subsequent round of directed evolution.
The winners of those next rounds all turned out to be pretty good.
However, the number of things we had to screen was
close to 10,000 mutants (with replicates).
So, again, keep that number in mind: it's $10^4$ mutants measured,
amounting to about $10^5$ activity measurements taken.</p>
<h3 id="machine-directed-evolution">Machine-directed evolution</h3><p>So now we moved on to machine-directed evolution.
Here, our strategy was to train a machine learning model to learn the relationship
between sequence and activity/chirality
and then use that model to score in-silico proposed mutants.
It's the most basic form of machine-directed evolution one can use.
Nowadays, there's lots of hype around generative models of sequences and the likes.
Still, back in 2019, we wanted to compare directed evolution
against a known and robust baseline strategy before going to fancier approaches.
The strategy we chose was a guess-and-check approach;
we're not biasing the generation of molecules in any way whatsoever.</p>
<p><strong>Note:</strong> For machine learning practitioners out there, by the way,
this example follows my opinion on how one <em>should</em> go about building ML systems.
Start with strong baselines first because you never know how long you'll need
to debug the fancier systems when they go wrong.</p>
<p>What exactly was the model we used,
and how did we take protein sequences and convert them into a numerical representation?
Well, around 2019 was when the UniRep authors first put on the UniRep paper Biorxiv.
My colleague Arkadij (intern at the time) quickly dug into it,
replicating some of the results in the paper and extending it in other useful ways.
Together,
we <a href="https://ericmjl.github.io/blog/2020/2/13/one-weird-trick-to-speed-up-your-tensorflow-model-100x/">reimplemented the entire model in JAX directly</a>.
That, plus user-friendly improvements to the model API,
made it an easy-to-use tool for us to obtain
a numerical descriptor set for our proteins.
We then threw a Random Forest model
on top of those numerical descriptors and trained it against our activity data.</p>
<p>That model turned out to be a great prioritizer but a horrible scorer.
Using the prioritization strategy described in the paper,
we could pick out high-performing mutants
from the $10^5$ in-silico proposed mutants pool.
Still, our predictions of their activity were off.
That's okay, though, because ultimately,
we were able to measure just $10^2$ proposed mutants
to get an activity distribution that was significantly right-shifted
compared to the $10^4$ mutants measured over three rounds of directed evolution.
(So that you don't have to scroll back up to see the result,
I've resurfaced the figure below - see the "ML" panel.)
In this way, with a good-enough model,
machine-directed evolution can be pretty sample-efficient.</p>
<p><img src="activity-dist.webp" alt=""></p>
<h3 id="structure-informed-machine-directed-evolution">Structure-informed machine-directed evolution</h3><p>This experiment was one that I helped design,
and I was suuuuuuuper happy that we got to do it.
One question I've had since grad school was this:
"When does combining mutations result in linear additivity of our property of interest?"
We'll have a <em>superb invariant handle</em> over enzyme evolution
if we know the answer to this question.
So, to answer this question, we took a hard look at the structure,
identified positions that were either <em>at</em> the active site (AS),
<em>neighboring</em> the active site (N),
or <em>distal</em> to the active site (D).
You can get a visual feel for these positions in the figure below.</p>
<p><img src="sgm-positions.webp" alt=""></p>
<p><em>Fig. 3(a) from our paper.
Here, we highlight the active site, neighboring, and distal positions
on IRED-88 that we mutated.</em></p>
<p>Then we took our best single mutants from each category,
and generated double and triple combinations of those mutant categories.
So, for example, we might combine two active site mutations
or two distal mutations with one neighbouring.
At its core, the idea was to test
whether combinations of these categories of mutations
resulted in <em>linear</em> additivity in activity.</p>
<p>The result?
If you don't touch the active site,
then you have a pretty good chance of being able to predict combination activity
by simply adding up their individual activity values.</p>
<p><img src="linear-additivity.webp" alt=""></p>
<p><em>Fig. 3(b) from our paper.
The results shown here are from our experiments probing linear additivity of mutations.
We show that combining mutations in positions distal to the active site
result in linearly additive mutations.</em></p>
<p>For me, this result was <em>huge</em>!
At the time, "big billion parameter BERT models" were all the rage --
and for me, this trend represented intellectual laziness on the part of modellers.
Was not the goal of modelling
to get a quantitative handle over the invariants of a problem?
Bucking the large model trend, with this experiment,
we had confirmed that a tremendously more straightforward principle (adding mutations)
for engineering enzymes was effective,
and we uncovered the conditions under which that principle worked predictably.</p>
<p>On this point, when we received our reviewer's comments, one of them wrote:</p>
<blockquote><p>the finding that linear combinations of mutations afford predictable activity increases is important</p>
</blockquote>
<p>I remember being soooooooooo happy when I read that comment.
Finally, someone recognized the importance of this point!</p>
<p>As for how the activity distribution looked?
Just like the machine-directed round -
right-shifted and with only $10^2$ samples measured.
See Fig. 2(b)'s "SGM panel" (resurfaced below for convenience).</p>
<p><img src="activity-dist.webp" alt=""></p>
<h3 id="low-n-engineering">Low N Engineering</h3><p>We also wanted to test-drive Low N engineering,
a strategy that first popped up in the original UniRep paper.
Low N engineering is similar in spirit to machine-directed evolution,
except that in our case,
we had to pretend that we didn't have access to the DMS dataset.
Training a model on just 24 data points feels weird for a machine learner.
Still, bolstered by the idea of linear additivity of mutations,
we were confident that Low N would work out just fine.
We took a random set of 24 mutants from the DMS dataset
and trained a model on their activity.
We then prioritized another 24 to order and test.
Likewise, we found a shift in activity distribution,
though not as dramatic as the machine-directed and structure-guided rounds.
(This is the "LowN" panel in Fig. 2(b).)</p>
<h2 id="what-did-we-learn">What did we learn?</h2><p>Firstly,
we showed that machine-directed evolution is
a <em>sample-efficient strategy for evolving enzymes</em>!
Rather than measure tens of thousands of mutants,
we only had to measure hundreds
to shift the enzyme activity distribution curve dramatically.
I think of it as giving ourselves much better shots on goal.</p>
<p>Secondly,
we uncovered the conditions under which simply combining mutations
can result in predictable, additive increases in activity.
Fancy models are not required for those circumstances!
If you know roughly what a protein's structure is,
you can find (what I think of as) the "linear basis functions" for enzyme engineering.
Thus, linearly adding mutations should <em>absolutely</em> be
a baseline for protein engineers and machine learners
that one tries to leverage for engineering -
or beat if trying to build fancier models.</p>
<h2 id="what-did-i-learn">What did I learn?</h2><p>That second point was, for me, the most satisfying piece of this work.
If we can categorize sequence positions as being part of the
(1) active site,
(2) neighbours to the active site, or
(3) distal to the active site,
then I am pretty sure that simply adding two distal mutations together
would provide the kind of additive effect that we desire.
I also now have this hypothesis that a large reason for why machine learning in enzyme engineering works
is because of linear additivity of mutational effects.</p>
<p>More importantly, I also learned a lot about the pace at which science moves.
Data science in the biomedical research space is rate-limited by
our ability to generate fit-for-purpose datasets.
The rate at which we can generate fit-for-purpose datasets is,
in turn, determined by people and equipment.
High throughput measurements enabled us to generate the data we needed;
if we didn't have that equipment, we'd be unable to do such a large-scale study.
People are the other variable to factor in:
I had to win the trust of my colleagues
by really empathizing with how they made decisions.
In this respect, my prior background at the bench
and the empathy that comes with experience
for the particular difficulties in executing experiments
helped me win their trust.
That trust, in turn, afforded me the credibility points to
participate in experiment design.</p>
<p>I am now also of the belief that
there's only so much we can do by leveraging public datasets;
empirically, I have found myself reaching for public datasets
only as a testbed to prototype a model,
but have rarely used that public dataset as part of
the final solution to our scientific problems.
For example, in this project,
we used public datasets to validate the model building piece.
Still, ultimately our decisions could <em>only be logically taken</em>
based on a model trained on fit-for-purpose data.
A model trained on data for one assay cannot logically be used
to predict results for another assay; things don't work that way.
I learned, thus, that in research data science,
we data scientists want to partner with colleagues
who are willing to generate fit-for-purpose data for the problem at hand.</p>

    </span>

    
    
    
    
    

    <hr>

    <i>Cite this blog post:</i>
    <div class="hll" style="position: relative;">
    <button class="copy-button" onclick="copyCitation()" title="Copy citation">
      <span class="copy-icon">ðŸ“‹</span>
    </button>
    <pre>
<span id="citation-text"><span><span style="color: darkblue; font-weight: bold">@article</span>{
    <span style="color: black; font-weight: bold">ericmjl-2021-machine-directed-evolution</span>,
    <span style="color: green; font-weight:bold">author</span> = <span style="color: maroon">{Eric J. Ma}</span>,
    <span style="color: green; font-weight:bold">title</span> = <span style="color: maroon">{Machine-Directed Evolution}</span>,
    <span style="color: green; font-weight:bold">year</span> = <span style="color: maroon">{2021}</span>,
    <span style="color: green; font-weight:bold">month</span> = <span style="color: maroon">{09}</span>,
    <span style="color: green; font-weight:bold">day</span> = <span style="color: maroon">{12}</span>,
    <span style="color: green; font-weight:bold">howpublished</span> = <span style="color: maroon">{\url{https://ericmjl.github.io}}</span>,
    <span style="color: green; font-weight:bold">journal</span> = <span style="color: maroon">{Eric J. Ma's Blog}</span>,
    <span style="color: green; font-weight:bold">url</span> = <span style="color: maroon">{https://ericmjl.github.io/blog/2021/9/12/machine-directed-evolution}</span>,
}
  </span></pre>
    </div>

    <script>
    function copyCitation() {
      const citationElement = document.getElementById('citation-text');
      const text = citationElement.textContent;

      // Create a temporary textarea element
      const textarea = document.createElement('textarea');
      textarea.value = text;
      document.body.appendChild(textarea);

      // Select and copy the text
      textarea.select();
      document.execCommand('copy');

      // Remove the temporary textarea
      document.body.removeChild(textarea);

      // Visual feedback
      const button = document.querySelector('.copy-button');
      const originalText = button.innerHTML;
      button.innerHTML = '<span class="copy-icon">âœ“</span>';
      button.style.backgroundColor = '#4CAF50';

      // Reset button after 2 seconds
      setTimeout(() => {
        button.innerHTML = originalText;
        button.style.backgroundColor = '';
      }, 2000);
    }
    </script>

    <style>
    .copy-button {
      position: absolute;
      top: 8px;
      right: 8px;
      background-color: transparent;
      color: #666;
      border: none;
      padding: 4px 8px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s ease;
      z-index: 1;
    }

    .copy-button:hover {
      background-color: rgba(0, 0, 0, 0.1);
      color: #333;
    }

    .copy-icon {
      font-size: 14px;
    }
    </style>
    <hr>
    <p>
      <i>I send out a newsletter with tips and tools
        for data scientists. Come check it out at
        <a href="https://dspn.substack.com">Substack</a>.</i>
    </p>
    <p>
      <i><span>If you would like to sponsor the coffee that goes into making my posts,
        please consider </span>
        <a href="https://github.com/sponsors/ericmjl">GitHub Sponsors</a>!</i>
    </p>
    <p>
      <i><span>Finally, I do free 30-minute GenAI strategy calls for teams
        that are looking to leverage GenAI for maximum impact. Consider </span>
        <a href="https://calendly.com/ericmjl/llm-chat">booking a call on Calendly</a>
        if you're interested!</i>
      </i>
    </p>
  </div>
  <div class="giscus" id="giscus-container"></div>
  <script>
    // Determine theme from localStorage or fallback to light
    var theme = localStorage.getItem('theme') === 'dark' ? 'dark' : 'light';
    var giscusScript = document.createElement('script');
    giscusScript.src = 'https://giscus.app/client.js';
    giscusScript.setAttribute('data-repo', 'ericmjl/website');
    giscusScript.setAttribute('data-repo-id', 'MDEwOlJlcG9zaXRvcnk2MDIzMzAxNg==');
    giscusScript.setAttribute('data-category', 'Comments');
    giscusScript.setAttribute('data-category-id', 'DIC_kwDOA5cVOM4Crqx4');
    giscusScript.setAttribute('data-mapping', 'pathname');
    giscusScript.setAttribute('data-strict', '1');
    giscusScript.setAttribute('data-reactions-enabled', '1');
    giscusScript.setAttribute('data-emit-metadata', '0');
    giscusScript.setAttribute('data-input-position', 'top');
    giscusScript.setAttribute('data-theme', theme);
    giscusScript.setAttribute('data-lang', 'en');
    giscusScript.crossOrigin = 'anonymous';
    giscusScript.async = true;
    document.getElementById('giscus-container').appendChild(giscusScript);
  </script>
</div>



        </div>

        <!-- Bottom Navigation (external links) -->
        <div class="terminal-nav">
            <nav class="terminal-menu" id="local-links">
                <ul>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="https://ericmjl.github.io/resume" rel="">
                            Resume</a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="https://www.linkedin.com/in/ericmjl" rel="">
                            LinkedIn</a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="http://github.com/ericmjl" rel="">
                            GitHub</a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="https://ericmjl--shortmail-run-app.modal.run/send/cce87ae9c1d7" rel="">
                            Contact Me</a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="https://ericmjl.github.io/blog.xml" rel="">
                            Blog RSS</a>
                    </li>
                    
                </ul>
            </nav>
        </div>

    </div>

    <script>
        // Theme toggle functionality
        function setGiscusTheme(theme) {
            const iframe = document.querySelector('iframe.giscus-frame');
            if (!iframe) return;
            iframe.contentWindow.postMessage(
                {
                    giscus: {
                        setConfig: {
                            theme: theme
                        }
                    }
                },
                'https://giscus.app'
            );
        }

        function toggleTheme() {
            const body = document.body;
            const themeToggle = document.querySelector('.theme-toggle');

            if (body.classList.contains('dark-mode')) {
                body.classList.remove('dark-mode');
                themeToggle.textContent = 'ðŸŒ™';
                localStorage.setItem('theme', 'light');
                setGiscusTheme('light');
            } else {
                body.classList.add('dark-mode');
                themeToggle.textContent = 'â˜€ï¸';
                localStorage.setItem('theme', 'dark');
                setGiscusTheme('dark');
            }
        }

        // Check for saved theme preference
        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme');
            const themeToggle = document.querySelector('.theme-toggle');

            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                themeToggle.textContent = 'â˜€ï¸';
                setTimeout(() => setGiscusTheme('dark'), 500);
            } else {
                setTimeout(() => setGiscusTheme('light'), 500);
            }
        });
    </script>

    <!-- Search functionality -->
    <script src="https://unpkg.com/lunr/lunr.js"></script>
    <script src="/static/js/search.js"></script>
</body>
