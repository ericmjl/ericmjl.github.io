<!doctype html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <style media="screen">
        body {
            padding-top: 70px;
            padding-bottom: 70px;
        }

        /* Dark mode styles */
        body.dark-mode {
            background-color: #1a1a1a;
            color: #ffffff;
        }

        body.dark-mode .terminal {
            background-color: #1a1a1a;
            color: #ffffff;
        }

        body.dark-mode a {
            color: #66b3ff;
        }

        body.dark-mode .terminal-menu {
            background-color: #1a1a1a;
        }

        body.dark-mode .terminal-menu li a {
            color: #ffffff;
        }

        body.dark-mode .terminal-menu li a:hover {
            background-color: #333333;
        }

        /* Theme toggle button styles */
        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            background-color: #f0f0f0;
            border: 1px solid #ccc;
        }

        body.dark-mode .theme-toggle {
            background-color: #333;
            color: #fff;
            border-color: #666;
        }

        .container {
            position: relative;
        }
    </style>
    
<!-- Syntax Highlighter. Use pygments. -->
<link rel="stylesheet" href="../../../../../static/pygments.css">


    

<meta property="og:title" content="Functional over object-oriented style for pipeline-esque code">
<meta property='og:url' content='http://ericmjl.github.io/blog//blog/functional-over-object-oriented-style-for-pipeline-esque-code' />



    <!-- Google Analytics -->
    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-12498603-2', 'auto');
        ga('send', 'pageview');
    </script>

    <link rel="stylesheet" href="https://unpkg.com/terminal.css@0.7.2/dist/terminal.min.css" />
    <link rel="stylesheet" href="/static/css/custom.css" />

    <style>
        .blog-card-container {
            display: flex;
        }

        .blog-card-left {
            flex: 1;
        }

        .blog-card-right {
            flex: 3;
        }

        /* Add rounded corners to banner images */
        .banner-image {
            border-radius: 8px;
            max-width: 98%;
            height: auto;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

    </style>
    <!-- Mathjax -->
    <!-- <script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML">
        </script>

    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
    </script> -->

    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
        </script>

    <!-- Mermaid.js -->
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({
            startOnLoad: true,
            theme: 'neutral',
            securityLevel: 'loose'
        });
    </script>
    <style>
        .mermaid {
            background-color: white;
            padding: 1em;
            margin: 1em 0;
            border-radius: 4px;
        }
    </style>

</head>

<title>Functional over object-oriented style for pipeline-esque code - Eric J. Ma's Personal Site</title>

<body>
    <div class="container">
        <button class="theme-toggle" onclick="toggleTheme()">🌙</button>
        <h1 class="logo">
            <a href="/">
                Eric J Ma's Website
            </a>
        </h1>
        <!-- Top Navigation (local links) -->

        <div class="terminal-nav">
            <nav class="terminal-menu" id="local-links">
                <ul>
                    
                    <li class="menu-item">
                        <!-- Set blinking cursor correctly on navigation -->
                        
                        
                        
                        
                        
                        <a href="/" rel="">Home</a>
                        
                    </li>
                    
                    <li class="menu-item">
                        <!-- Set blinking cursor correctly on navigation -->
                        
                        
                        
                        
                        
                        <a class="terminal-prompt" href="/blog" rel="">Blog</a>
                        
                    </li>
                    
                    <li class="menu-item">
                        <!-- Set blinking cursor correctly on navigation -->
                        
                        
                        
                        
                        
                        <a href="/books" rel="">Books</a>
                        
                    </li>
                    
                    <li class="menu-item">
                        <!-- Set blinking cursor correctly on navigation -->
                        
                        
                        
                        
                        
                        <a href="/open-source" rel="">Open Source</a>
                        
                    </li>
                    
                    <li class="menu-item">
                        <!-- Set blinking cursor correctly on navigation -->
                        
                        
                        
                        
                        
                        <a href="/projects" rel="">Projects</a>
                        
                    </li>
                    
                    <li class="menu-item">
                        <!-- Set blinking cursor correctly on navigation -->
                        
                        
                        
                        
                        
                        <a href="/talks" rel="">Talks</a>
                        
                    </li>
                    
                    <li class="menu-item">
                        <!-- Set blinking cursor correctly on navigation -->
                        
                        
                        
                        
                        
                        <a href="/teaching" rel="">Teaching</a>
                        
                    </li>
                    
                    <li class="menu-item">
                        <!-- Set blinking cursor correctly on navigation -->
                        
                        
                        
                        
                        
                        <a href="/user-manual" rel="">User Manual</a>
                        
                    </li>
                    
                    <li class="menu-item">
                        <!-- Set blinking cursor correctly on navigation -->
                        
                        
                        
                        
                        
                        <a href="/bio" rel="">Bio</a>
                        
                    </li>
                    
                </ul>
            </nav>
        </div>

        <!-- Body -->
        <div id="body">
            


<div class="terminal-card">
  <header id="post_title" name="post_title">
<!-- Set title style -->
<span name="title" id="title">Functional over object-oriented style for pipeline-esque code</span>
</header>
  <div class="card-body">
    
<!-- Append author -->
<small>
  <p>
    written by
    
    <a class="author" href="https://twitter.com/ericmjl">Eric J. Ma</a>
    
    on
    <span id="pub_date" name="pub_date">2022-04-01</span>

    
    | tags:
    <!-- Append tags after author -->
    <span class="boxed" id="tags" name="tags">
      <a class="tags" href="../../../../tag/data science/">
        data science
      </a>
    </span>
    <span class="boxed" id="tags" name="tags">
      <a class="tags" href="../../../../tag/pipeline/">
        pipeline
      </a>
    </span>
    <span class="boxed" id="tags" name="tags">
      <a class="tags" href="../../../../tag/programming style/">
        programming style
      </a>
    </span>
    <span class="boxed" id="tags" name="tags">
      <a class="tags" href="../../../../tag/programming/">
        programming
      </a>
    </span>
    <span class="boxed" id="tags" name="tags">
      <a class="tags" href="../../../../tag/software development/">
        software development
      </a>
    </span>
    
  </p>
  
</small>

    <hr>

    

    <!-- NOTE: I am keeping this here just for preview purposes.
     We must rely on the webp logo for the blog post.
     Pre-commit hooks will ensure that the png logo is converted to webp.-->
    

    
    <div class="blog-summary">
      <i><p>I'm of the opinion that for most data science code,
it makes more sense to write functions than objects.
This probably isn't controversion,
but if you're curious why,
then this blog post explains my thought process.</p>
</i>
    </div>
    

    <span id="post_body" name="post_body">
      <p>Where possible, in my data science projects,
I usually go for a functional programming style over an object-oriented style.
I'd like to explain why this could be advantageous from the standpoint of a mental model,
which is an idea that my friend Jesse Johnson has elaborated on
<a href="https://scalingbiotech.com/2022/01/26/the-giant-hidden-problem-plaguing-tech-biotechs/">in the context of in biotech organizations</a>.</p>
<h2 id="types-standards-and-pipelines">Types, standards, and pipelines</h2><p>It all starts with types -- basically, what objects are floating around in a program.
When writing data science code, data type transformations are commonplace.
Reasoning about the data types is hard enough without introducing another object --
and, therefore, another type.
Introducing another type into the program
<a href="https://xkcd.com/927/">is like introducing another standard</a> --
suddenly, you have one more thing to worry about.</p>
<p>Here's an example.
We read in a CSV file and spit out a <code>pandas</code> DataFrame.
That <code>pandas</code> <code>DataFrame</code> goes into another function
that constructs a PyMC model and returns the model.
Next, the model goes into another function that calls on a PyMC sampler
and returns an <code>InferenceData</code> object.
The <code>InferenceData</code> object then gets parsed back into another <code>DataFrame</code>
for multiple uses -- to generate plots, get checked into a database, and more.</p>
<p>If we were to introduce a new object, say,
a <code>DataModeller</code> object,
we might encapsulate all of those steps in the following way:</p>
<div class="hll"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">DataModeller</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">make_model</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
        <span class="o">...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sample</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">idata</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_posterior</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
        <span class="o">...</span>
</pre></div>
<p>Now, the critical trouble I usually run into with classes-for-data-pipelining
is not merely about needing to create new objects and hence, new "types" in the project.
It's also that the class methods can, in theory,
be called without any enforcement of order - and errors will result.
It's challenging to reason clearly about the correct order of operations
when reading just the code.
The atomic class methods are attached to the class
at the same level of abstraction as the higher-level class methods,
and the object's internal state can be created on-the-fly --
and is implicit, not explicit.</p>
<p>By adopting a functional style,
we can make keeping atomic functions
and higher-order functions mentally separate easier.
We can keep the atomic functions inside a submodule and higher-order functions
higher up in the source code hierarchy.
And by calling on the higher-order functions,
we can easily read off the correct order of operations that need to happen,
i.e. the pipeline.
Riffing off the above example:</p>
<div class="hll"><pre><span></span><span class="c1"># This is where the atomic functions might live, e.g. `src/models/stuff.py`</span>
<span class="k">def</span><span class="w"> </span><span class="nf">make_model_1</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">:</span>
    <span class="o">...</span>
    <span class="k">return</span> <span class="n">model</span>

<span class="k">def</span><span class="w"> </span><span class="nf">make_model_2</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">:</span>
    <span class="o">...</span>
    <span class="k">return</span> <span class="n">model</span>

<span class="k">def</span><span class="w"> </span><span class="nf">sample</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">az</span><span class="o">.</span><span class="n">InferenceData</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convenience wrapper around `pm.sample` with defaults for our problem.&quot;&quot;&quot;</span>
    <span class="o">...</span>
    <span class="k">return</span> <span class="n">idata</span>

<span class="k">def</span><span class="w"> </span><span class="nf">process_posterior</span><span class="p">(</span><span class="n">idata</span><span class="p">:</span> <span class="n">az</span><span class="o">.</span><span class="n">InferenceData</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="o">...</span>
    <span class="k">return</span> <span class="n">posterior_df</span>
</pre></div>
<p>And now the functions are easily composable to make higher-order functions:</p>
<div class="hll"><pre><span></span><span class="c1"># This is where the higher-order functions live, e.g. in `src/__init__.py`</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.models.stuff</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_model_1</span><span class="p">,</span> <span class="n">make_model_2</span><span class="p">,</span> <span class="n">sample</span><span class="p">,</span> <span class="n">process_posterior</span>

<span class="n">model_name_mapping</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;model1&quot;</span><span class="p">:</span> <span class="n">make_model_1</span><span class="p">,</span>
    <span class="s2">&quot;model2&quot;</span><span class="p">:</span> <span class="n">make_model_2</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">model</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Some docstring here.&quot;&quot;&quot;</span>
    <span class="n">model_func</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="n">model_name_mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span> <span class="o">=</span> <span class="n">model_func</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">idata</span><span class="p">:</span> <span class="n">az</span><span class="o">.</span><span class="n">InferenceData</span> <span class="o">=</span> <span class="n">sample</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="n">posterior_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="n">process_posterior</span><span class="p">(</span><span class="n">idata</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">posterior_df</span>
</pre></div>
<p>A natural hierarchy appears here!
We import lower-level functions from deeper within the library;
with higher-level functions, we go closer to the top-level imports.</p>
<p>(In the example above, I also took the liberty of annotating types in-line.
They are another form of in-line documentation.
They also help with reasoning about the workflow much more efficiently,
especially if someone is just getting used to, say,
the <code>df -&gt; model -&gt; idata -&gt; posterior_df</code> workflow.)</p>
<p>As you probably can see here, too,
using functions enables us to easily see the idiomatic workflow.
Our mental model is more easily read off by the next person
in the pipelines-as-functions paradigm rather than pipelines-as-objects paradigm.</p>
<p>And as a side benefit,
if we think carefully about the data types we pass around, consume, and generate,
then we end up with easily reusable functions.
That's another awesome side effect!</p>
<h2 id="objects-are-fine-just-not-everywhere">Objects are fine, just not <em>everywhere</em></h2><p>Now, just to be clear,
I'm not advocating an abdication of objects altogether.
Clearly, a PyMC Model, InferenceData and DataFrames are all objects themselves.
<em>For someone who works with data, when do objects make sense?</em></p>
<p>I think in the context of data pipelines,
objects make the most sense as a data container.
One clear example is configuration objects
(which I usually implement as a dataclass with very-few-to-zero class methods).
Another clear example is when 3-4 related dataframes need to be kept together.
Also, we may need convenient class methods to dump them to disk at once.
Here a dataclass with 3-4 corresponding attributes
and a single class method would make a ton of sense.</p>
<p>Pipelines are best thought of as functions
and are therefore best implemented as functions.
Data (and data containers) are best thought of as objects
and are therefore best implemented as objects.
Objects as data pipelines, though?
In my opinion, doing so only adds confusion.
Once again, it's my conviction,
having written more than 9 years of Python data science code,
that pipelines-as-functions express the developer's mental model of the pipeline
more cleanly than pipelines-as-objects.</p>
<h2 id="the-twist">The twist</h2><p>Aaaaaand I know there's going to be someone who says,
"But you can make objects callable too, right?"
Yeah, I know that's doable :).
On this point, the flexibility of Python
allows for things to be implemented in multiple ways.
However, in line with the Zen of Python,
it's probably best to adopt one clear way of implementing things.
Pipelines as functions, data as objects.
This is a much saner way of establishing simple idioms that,
subjectively, allows for cleaner reasoning about our code.</p>

    </span>

    
    
    
    
    

    <hr>

    <i>Cite this blog post:</i>
    <div class="hll" style="position: relative;">
    <button class="copy-button" onclick="copyCitation()" title="Copy citation">
      <span class="copy-icon">📋</span>
    </button>
    <pre>
<span id="citation-text"><span><span style="color: darkblue; font-weight: bold">@article</span>{
    <span style="color: black; font-weight: bold">ericmjl-2022-functional-over-object-oriented-style-for-pipeline-esque-code</span>,
    <span style="color: green; font-weight:bold">author</span> = <span style="color: maroon">{Eric J. Ma}</span>,
    <span style="color: green; font-weight:bold">title</span> = <span style="color: maroon">{Functional over object-oriented style for pipeline-esque code}</span>,
    <span style="color: green; font-weight:bold">year</span> = <span style="color: maroon">{2022}</span>,
    <span style="color: green; font-weight:bold">month</span> = <span style="color: maroon">{04}</span>,
    <span style="color: green; font-weight:bold">day</span> = <span style="color: maroon">{01}</span>,
    <span style="color: green; font-weight:bold">howpublished</span> = <span style="color: maroon">{\url{https://ericmjl.github.io}}</span>,
    <span style="color: green; font-weight:bold">journal</span> = <span style="color: maroon">{Eric J. Ma's Blog}</span>,
    <span style="color: green; font-weight:bold">url</span> = <span style="color: maroon">{https://ericmjl.github.io/blog/2022/4/1/functional-over-object-oriented-style-for-pipeline-esque-code}</span>,
}
  </span></pre>
    </div>

    <script>
    function copyCitation() {
      const citationElement = document.getElementById('citation-text');
      const text = citationElement.textContent;

      // Create a temporary textarea element
      const textarea = document.createElement('textarea');
      textarea.value = text;
      document.body.appendChild(textarea);

      // Select and copy the text
      textarea.select();
      document.execCommand('copy');

      // Remove the temporary textarea
      document.body.removeChild(textarea);

      // Visual feedback
      const button = document.querySelector('.copy-button');
      const originalText = button.innerHTML;
      button.innerHTML = '<span class="copy-icon">✓</span>';
      button.style.backgroundColor = '#4CAF50';

      // Reset button after 2 seconds
      setTimeout(() => {
        button.innerHTML = originalText;
        button.style.backgroundColor = '';
      }, 2000);
    }
    </script>

    <style>
    .copy-button {
      position: absolute;
      top: 8px;
      right: 8px;
      background-color: transparent;
      color: #666;
      border: none;
      padding: 4px 8px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s ease;
      z-index: 1;
    }

    .copy-button:hover {
      background-color: rgba(0, 0, 0, 0.1);
      color: #333;
    }

    .copy-icon {
      font-size: 14px;
    }
    </style>
    <hr>
    <p>
      <i>I send out a newsletter with tips and tools
        for data scientists. Come check it out at
        <a href="https://dspn.substack.com">Substack</a>.</i>
    </p>
    <p>
      <i><span>If you would like to sponsor the coffee that goes into making my posts,
        please consider </span>
        <a href="https://github.com/sponsors/ericmjl">GitHub Sponsors</a>!</i>
    </p>
    <p>
      <i><span>Finally, I do free 30-minute GenAI strategy calls for teams
        that are looking to leverage GenAI for maximum impact. Consider </span>
        <a href="https://calendly.com/ericmjl/llm-chat">booking a call on Calendly</a>
        if you're interested!</i>
      </i>
    </p>
  </div>
  <div class="giscus" id="giscus-container"></div>
  <script>
    // Determine theme from localStorage or fallback to light
    var theme = localStorage.getItem('theme') === 'dark' ? 'dark' : 'light';
    var giscusScript = document.createElement('script');
    giscusScript.src = 'https://giscus.app/client.js';
    giscusScript.setAttribute('data-repo', 'ericmjl/website');
    giscusScript.setAttribute('data-repo-id', 'MDEwOlJlcG9zaXRvcnk2MDIzMzAxNg==');
    giscusScript.setAttribute('data-category', 'Comments');
    giscusScript.setAttribute('data-category-id', 'DIC_kwDOA5cVOM4Crqx4');
    giscusScript.setAttribute('data-mapping', 'pathname');
    giscusScript.setAttribute('data-strict', '1');
    giscusScript.setAttribute('data-reactions-enabled', '1');
    giscusScript.setAttribute('data-emit-metadata', '0');
    giscusScript.setAttribute('data-input-position', 'top');
    giscusScript.setAttribute('data-theme', theme);
    giscusScript.setAttribute('data-lang', 'en');
    giscusScript.crossOrigin = 'anonymous';
    giscusScript.async = true;
    document.getElementById('giscus-container').appendChild(giscusScript);
  </script>
</div>



        </div>

        <!-- Bottom Navigation (external links) -->
        <div class="terminal-nav">
            <nav class="terminal-menu" id="local-links">
                <ul>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="https://ericmjl.github.io/resume" rel="">
                            Resume</a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="https://www.linkedin.com/in/ericmjl" rel="">
                            LinkedIn</a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="http://github.com/ericmjl" rel="">
                            GitHub</a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="https://ericmjl--shortmail-run-app.modal.run/send/cce87ae9c1d7" rel="">
                            Contact Me</a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="https://ericmjl.github.io/blog.xml" rel="">
                            Blog RSS</a>
                    </li>
                    
                </ul>
            </nav>
        </div>

    </div>

    <script>
        // Theme toggle functionality
        function setGiscusTheme(theme) {
            const iframe = document.querySelector('iframe.giscus-frame');
            if (!iframe) return;
            iframe.contentWindow.postMessage(
                {
                    giscus: {
                        setConfig: {
                            theme: theme
                        }
                    }
                },
                'https://giscus.app'
            );
        }

        function toggleTheme() {
            const body = document.body;
            const themeToggle = document.querySelector('.theme-toggle');

            if (body.classList.contains('dark-mode')) {
                body.classList.remove('dark-mode');
                themeToggle.textContent = '🌙';
                localStorage.setItem('theme', 'light');
                setGiscusTheme('light');
            } else {
                body.classList.add('dark-mode');
                themeToggle.textContent = '☀️';
                localStorage.setItem('theme', 'dark');
                setGiscusTheme('dark');
            }
        }

        // Check for saved theme preference
        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme');
            const themeToggle = document.querySelector('.theme-toggle');

            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                themeToggle.textContent = '☀️';
                setTimeout(() => setGiscusTheme('dark'), 500);
            } else {
                setTimeout(() => setGiscusTheme('light'), 500);
            }
        });
    </script>
</body>
