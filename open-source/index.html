<!doctype html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <style media="screen">
        body {
            padding-top: 70px;
            padding-bottom: 70px;
        }

        /* Dark mode styles */
        body.dark-mode {
            background-color: #1a1a1a;
            color: #ffffff;
        }

        body.dark-mode .terminal {
            background-color: #1a1a1a;
            color: #ffffff;
        }

        body.dark-mode a {
            color: #66b3ff;
        }

        body.dark-mode .terminal-menu {
            background-color: #1a1a1a;
        }

        body.dark-mode .terminal-menu li a {
            color: #ffffff;
        }

        body.dark-mode .terminal-menu li a:hover {
            background-color: #333333;
        }

        /* Theme toggle button styles */
        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            background-color: #f0f0f0;
            border: 1px solid #ccc;
        }

        body.dark-mode .theme-toggle {
            background-color: #333;
            color: #fff;
            border-color: #666;
        }

        .container {
            position: relative;
        }
    </style>
    
    

    
    

    <!-- Google Analytics 4 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-51WHZQ1VQ8"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-51WHZQ1VQ8');
    </script>

    <!-- PostHog Analytics -->
    <script>
        !function(t,e){var o,n,p,r;e.__SV||(window.posthog && window.posthog.__loaded)||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.crossOrigin="anonymous",p.async=!0,p.src=s.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="init Xr es pi Zr rs Kr Qr capture Ni calculateEventProperties os register register_once register_for_session unregister unregister_for_session ds getFeatureFlag getFeatureFlagPayload isFeatureEnabled reloadFeatureFlags updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures on onFeatureFlags onSurveysLoaded onSessionId getSurveys getActiveMatchingSurveys renderSurvey displaySurvey cancelPendingSurvey canRenderSurvey canRenderSurveyAsync identify setPersonProperties group resetGroups setPersonPropertiesForFlags resetPersonPropertiesForFlags setGroupPropertiesForFlags resetGroupPropertiesForFlags reset get_distinct_id getGroups get_session_id get_session_replay_url alias set_config startSessionRecording stopSessionRecording sessionRecordingStarted captureException startExceptionAutocapture stopExceptionAutocapture loadToolbar get_property getSessionProperty us ns createPersonProfile hs Vr vs opt_in_capturing opt_out_capturing has_opted_in_capturing has_opted_out_capturing get_explicit_consent_status is_capturing clear_opt_in_out_capturing ss debug O ls getPageViewId captureTraceFeedback captureTraceMetric qr".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
        posthog.init('phc_907JjTIpyrrIxT5wKiahneMoCl6rMc2XNfaYXrGZ3Fe', {
            api_host: 'https://us.i.posthog.com',
            defaults: '2025-11-30',
            person_profiles: 'identified_only',
        })
    </script>

    <link rel="stylesheet" href="https://unpkg.com/terminal.css@0.7.2/dist/terminal.min.css" />
    <link rel="stylesheet" href="/static/css/custom.css" />
    <!-- Mathjax -->
    <!-- <script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML">
        </script>

    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
    </script> -->

    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
        </script>

    <!-- Mermaid.js -->
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({
            startOnLoad: true,
            theme: 'neutral',
            securityLevel: 'loose'
        });
    </script>
    <style>
        .mermaid {
            background-color: white;
            padding: 1em;
            margin: 1em 0;
            border-radius: 4px;
        }
    </style>

</head>

<title>Open Source - Eric J. Ma's Personal Site</title>

<body>
    <div class="container">
        <button class="theme-toggle" onclick="toggleTheme()">ðŸŒ™</button>
        <h1 class="logo">
            <a href="/">
                Eric J Ma's Website
            </a>
        </h1>
        <!-- Top Navigation (local links) -->

        <div class="terminal-nav">
            <nav class="terminal-menu" id="local-links">
                <ul>
                    
                    <li class="menu-item">
                        <!-- Set blinking cursor correctly on navigation -->
                        
                        
                        
                        
                        
                        <a href="/" rel="">Home</a>
                        
                    </li>
                    
                    <li class="menu-item">
                        <!-- Set blinking cursor correctly on navigation -->
                        
                        
                        
                        
                        
                        <a href="/blog" rel="">Blog</a>
                        
                    </li>
                    
                    <li class="menu-item">
                        <!-- Set blinking cursor correctly on navigation -->
                        
                        
                        
                        
                        
                        <a href="/books" rel="">Books</a>
                        
                    </li>
                    
                    <li class="menu-item">
                        <!-- Set blinking cursor correctly on navigation -->
                        
                        
                        
                        
                        
                        <a class="terminal-prompt" href="/open-source" rel="">Open Source</a>
                        
                    </li>
                    
                    <li class="menu-item">
                        <!-- Set blinking cursor correctly on navigation -->
                        
                        
                        
                        
                        
                        <a href="/projects" rel="">Projects</a>
                        
                    </li>
                    
                    <li class="menu-item">
                        <!-- Set blinking cursor correctly on navigation -->
                        
                        
                        
                        
                        
                        <a href="/talks" rel="">Talks</a>
                        
                    </li>
                    
                    <li class="menu-item">
                        <!-- Set blinking cursor correctly on navigation -->
                        
                        
                        
                        
                        
                        <a href="/teaching" rel="">Teaching</a>
                        
                    </li>
                    
                    <li class="menu-item">
                        <!-- Set blinking cursor correctly on navigation -->
                        
                        
                        
                        
                        
                        <a href="/user-manual" rel="">User Manual</a>
                        
                    </li>
                    
                    <li class="menu-item">
                        <!-- Set blinking cursor correctly on navigation -->
                        
                        
                        
                        
                        
                        <a href="/bio" rel="">Bio</a>
                        
                    </li>
                    
                    <li class="menu-item">
                        <a href="#" id="search-button" title="Search (Ctrl+K)">Search</a>
                    </li>
                </ul>
            </nav>
        </div>

        <!-- Body -->
        <div id="body">
            
<h1>Open Source</h1>

<p>
    I believe in open source as a way to give back to the community and collaborate with others.
    Here's a view of my open source activity.
</p>

<!-- What I'm Working On Now -->
<section id="recent-activity">
    <h2>What I'm Working On Now</h2>
    <p class="section-subtitle">Live activity from GitHub</p>
    <div id="activity-container" class="loading">
        <p>Loading recent activity...</p>
    </div>
</section>

<!-- Projects I Maintain -->
<section id="maintained-projects">
    <h2>Projects I Maintain</h2>
    <p class="section-subtitle">Open source projects I created or help maintain</p>
    <div id="projects-container" class="loading">
        <p>Loading projects...</p>
    </div>
</section>

<!-- Contributions to Other Projects -->
<section id="contributions">
    <h2>Contributions to Other Projects</h2>
    <p class="section-subtitle">Pull requests to projects I don't maintain (last 12 months)</p>
    <div id="contributions-container" class="loading">
        <p>Loading contributions...</p>
    </div>
</section>

<p class="data-timestamp" id="data-timestamp"></p>

<script>
(function() {
    'use strict';

    const GITHUB_USERNAME = 'ericmjl';

    // Fetch live activity directly from GitHub API
    async function fetchLiveActivity() {
        try {
            const response = await fetch(`https://api.github.com/users/${GITHUB_USERNAME}/events/public?per_page=100`);
            if (!response.ok) throw new Error('Failed to fetch GitHub events');
            const events = await response.json();

            // Process events into activity summary
            const cutoff = new Date();
            cutoff.setDate(cutoff.getDate() - 30);

            const repoActivity = {};

            for (const event of events) {
                const eventTime = new Date(event.created_at);
                if (eventTime < cutoff) continue;

                if (event.type === 'PushEvent') {
                    const repo = event.repo.name;
                    const payload = event.payload;
                    const commits = payload.commits || [];
                    const commitCount = commits.length || payload.size || 1;

                    if (!repoActivity[repo]) {
                        repoActivity[repo] = {
                            repo: repo,
                            repo_url: `https://github.com/${repo}`,
                            commit_count: 0,
                            last_commit_date: event.created_at,
                            commits: []
                        };
                    }

                    repoActivity[repo].commit_count += commitCount;

                    // Collect commit messages
                    for (const commit of commits.slice(0, 3)) {
                        repoActivity[repo].commits.push({
                            message: commit.message.split('\n')[0],
                            sha: commit.sha.substring(0, 7)
                        });
                    }
                }
            }

            // Convert to sorted array
            const activity = Object.values(repoActivity)
                .sort((a, b) => b.commit_count - a.commit_count)
                .slice(0, 10);

            // Trim commits to 5 per repo
            for (const item of activity) {
                item.commits = item.commits.slice(0, 5);
            }

            renderRecentActivity(activity);
        } catch (error) {
            console.error('Error fetching live activity:', error);
            document.getElementById('activity-container').innerHTML =
                '<p class="error">Failed to load live activity. GitHub API may be rate-limited.</p>';
        }
    }

    // Fetch live contributions directly from GitHub API
    async function fetchLiveContributions() {
        try {
            const since = new Date();
            since.setFullYear(since.getFullYear() - 1);
            const sinceStr = since.toISOString().split('T')[0];

            const query = `author:${GITHUB_USERNAME} type:pr created:>${sinceStr}`;
            const url = `https://api.github.com/search/issues?q=${encodeURIComponent(query)}&sort=created&order=desc&per_page=100`;

            const response = await fetch(url);
            if (!response.ok) throw new Error('Failed to fetch GitHub PRs');
            const data = await response.json();

            // Filter out PRs to own repos and group by repo
            const prsByRepo = {};

            for (const item of data.items || []) {
                const repoUrl = item.repository_url;
                const repoName = repoUrl.split('/').slice(-2).join('/');

                // Skip PRs to own repos
                if (repoName.startsWith(`${GITHUB_USERNAME}/`)) continue;

                if (!prsByRepo[repoName]) {
                    prsByRepo[repoName] = {
                        repo: repoName,
                        prs: [],
                        merged_count: 0
                    };
                }

                const pr = {
                    title: item.title,
                    url: item.html_url,
                    state: item.state,
                    merged: item.pull_request?.merged_at ? true : false
                };

                prsByRepo[repoName].prs.push(pr);
                if (pr.merged) {
                    prsByRepo[repoName].merged_count++;
                }
            }

            // Convert to array and sort by PR count
            const contributions = Object.values(prsByRepo)
                .sort((a, b) => b.prs.length - a.prs.length)
                .slice(0, 15);

            renderContributions(contributions);
        } catch (error) {
            console.error('Error fetching live contributions:', error);
            document.getElementById('contributions-container').innerHTML =
                '<p class="error">Failed to load live contributions. GitHub API may be rate-limited.</p>';
        }
    }

    // Fetch pre-built data for projects and contributions
    async function loadPrebuiltData() {
        try {
            const response = await fetch('/static/data/github-data.json');
            if (!response.ok) throw new Error('Failed to load GitHub data');
            const data = await response.json();

            renderMaintainedProjects(data.maintained_projects);

            // Show timestamp for pre-built data
            const timestamp = new Date(data.generated_at);
            document.getElementById('data-timestamp').textContent =
                `Project data last updated: ${timestamp.toLocaleDateString()} ${timestamp.toLocaleTimeString()}`;
        } catch (error) {
            console.error('Error loading pre-built data:', error);
            document.getElementById('projects-container').innerHTML =
                '<p class="error">Failed to load project data. Please try refreshing the page.</p>';
        }
    }

    function renderRecentActivity(activity) {
        const container = document.getElementById('activity-container');
        if (!activity || activity.length === 0) {
            container.innerHTML = '<p>No recent activity found.</p>';
            return;
        }

        const html = activity.map(item => `
            <div class="activity-item">
                <div class="activity-header">
                    <a href="${item.repo_url}" class="activity-repo">${item.repo}</a>
                    <span class="activity-count">${item.commit_count} commit${item.commit_count !== 1 ? 's' : ''}</span>
                </div>
                ${item.commits && item.commits.length > 0 ? `
                <ul class="activity-commits">
                    ${item.commits.slice(0, 3).map(c => `
                        <li><code>${c.sha}</code> ${escapeHtml(c.message)}</li>
                    `).join('')}
                </ul>
                ` : ''}
            </div>
        `).join('');

        container.innerHTML = html;
        container.classList.remove('loading');
    }

    function renderMaintainedProjects(projects) {
        const container = document.getElementById('projects-container');
        if (!projects || projects.length === 0) {
            container.innerHTML = '<p>No projects found.</p>';
            return;
        }

        const html = `
            <div class="projects-grid">
                ${projects.map(project => `
                    <div class="project-card">
                        <div class="project-header">
                            <a href="${project.url}" class="project-name">${project.name}</a>
                            <span class="project-language">${project.language || 'N/A'}</span>
                        </div>
                        <p class="project-description">${escapeHtml(project.description || 'No description')}</p>
                        <div class="project-stats">
                            <span class="stat" title="Stars">&#9733; ${formatNumber(project.stars)}</span>
                            <span class="stat" title="Forks">&#127860; ${formatNumber(project.forks)}</span>
                            <span class="stat" title="Open Issues">&#128203; ${project.open_issues}</span>
                        </div>
                        <div class="project-topics">
                            ${(project.topics || []).slice(0, 5).map(t => `<span class="topic">${t}</span>`).join('')}
                        </div>
                        <div class="project-updated">
                            Last updated: ${formatDate(project.pushed_at)}
                        </div>
                    </div>
                `).join('')}
            </div>
        `;

        container.innerHTML = html;
        container.classList.remove('loading');
    }

    function renderContributions(contributions) {
        const container = document.getElementById('contributions-container');
        if (!contributions || contributions.length === 0) {
            container.innerHTML = '<p>No contributions found.</p>';
            return;
        }

        const html = `
            <div class="contributions-list">
                ${contributions.map(contrib => `
                    <div class="contribution-item">
                        <div class="contribution-header">
                            <span class="contribution-repo">${contrib.repo}</span>
                            <span class="contribution-stats">
                                ${contrib.prs.length} PR${contrib.prs.length !== 1 ? 's' : ''}
                                ${contrib.merged_count > 0 ? `(${contrib.merged_count} merged)` : ''}
                            </span>
                        </div>
                        <ul class="contribution-prs">
                            ${contrib.prs.slice(0, 3).map(pr => `
                                <li>
                                    <a href="${pr.url}" class="pr-link ${pr.state}">
                                        ${escapeHtml(pr.title)}
                                    </a>
                                    <span class="pr-state pr-${pr.state}">${pr.merged ? 'merged' : pr.state}</span>
                                </li>
                            `).join('')}
                            ${contrib.prs.length > 3 ? `<li class="more-prs">+ ${contrib.prs.length - 3} more</li>` : ''}
                        </ul>
                    </div>
                `).join('')}
            </div>
        `;

        container.innerHTML = html;
        container.classList.remove('loading');
    }

    function escapeHtml(text) {
        if (!text) return '';
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    function formatNumber(num) {
        if (num >= 1000) {
            return (num / 1000).toFixed(1) + 'k';
        }
        return num.toString();
    }

    function formatDate(dateStr) {
        if (!dateStr) return 'Unknown';
        const date = new Date(dateStr);
        const now = new Date();
        const diffDays = Math.floor((now - date) / (1000 * 60 * 60 * 24));

        if (diffDays === 0) return 'Today';
        if (diffDays === 1) return 'Yesterday';
        if (diffDays < 7) return `${diffDays} days ago`;
        if (diffDays < 30) return `${Math.floor(diffDays / 7)} week${Math.floor(diffDays / 7) > 1 ? 's' : ''} ago`;
        if (diffDays < 365) return `${Math.floor(diffDays / 30)} month${Math.floor(diffDays / 30) > 1 ? 's' : ''} ago`;
        return date.toLocaleDateString();
    }

    // Load data when DOM is ready
    function init() {
        // Fetch live activity from GitHub API
        fetchLiveActivity();
        // Fetch live contributions from GitHub API
        fetchLiveContributions();
        // Load pre-built data for projects
        loadPrebuiltData();
    }

    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
    } else {
        init();
    }
})();
</script>

        </div>

        <!-- Bottom Navigation (external links) -->
        <div class="terminal-nav">
            <nav class="terminal-menu" id="local-links">
                <ul>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="https://ericmjl.github.io/resume" rel="">
                            Resume</a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="https://www.linkedin.com/in/ericmjl" rel="">
                            LinkedIn</a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="http://github.com/ericmjl" rel="">
                            GitHub</a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="https://ericmjl--shortmail-run-app.modal.run/send/cce87ae9c1d7" rel="">
                            Contact Me</a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="https://ericmjl.github.io/blog.xml" rel="">
                            Blog RSS</a>
                    </li>
                    
                </ul>
            </nav>
        </div>

    </div>

    <script>
        // Theme toggle functionality
        function setGiscusTheme(theme) {
            const iframe = document.querySelector('iframe.giscus-frame');
            if (!iframe) return;
            iframe.contentWindow.postMessage(
                {
                    giscus: {
                        setConfig: {
                            theme: theme
                        }
                    }
                },
                'https://giscus.app'
            );
        }

        function toggleTheme() {
            const body = document.body;
            const themeToggle = document.querySelector('.theme-toggle');

            if (body.classList.contains('dark-mode')) {
                body.classList.remove('dark-mode');
                themeToggle.textContent = 'ðŸŒ™';
                localStorage.setItem('theme', 'light');
                setGiscusTheme('light');
            } else {
                body.classList.add('dark-mode');
                themeToggle.textContent = 'â˜€ï¸';
                localStorage.setItem('theme', 'dark');
                setGiscusTheme('dark');
            }
        }

        // Check for saved theme preference
        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme');
            const themeToggle = document.querySelector('.theme-toggle');

            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                themeToggle.textContent = 'â˜€ï¸';
                setTimeout(() => setGiscusTheme('dark'), 500);
            } else {
                setTimeout(() => setGiscusTheme('light'), 500);
            }
        });
    </script>

    <!-- Search functionality -->
    <script src="https://unpkg.com/lunr/lunr.js"></script>
    <script src="/static/js/search.js"></script>
</body>
